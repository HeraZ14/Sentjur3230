{% extends 'base.html' %}
{% block content %}

<div class="payment-container">
    <h1 class="payment-title">Zaključi plačilo</h1>
    <div class="payment-card">
        <p style="color: black;">Znesek za plačilo: {{ amount|floatformat:2 }} €</p>
        <!-- Stripe Card Payment -->
        <form id="payment-form" class="stripe-form">
            <div id="payment-element" class="stripe-element"></div>
            <button id="submit" class="vozek-button stripe-btn">Plačaj</button>
            <div id="error-message" class="stripe-error"></div>
        </form>


        <form method="POST" id="crypto-payment-form" class="crypto-form">
            {% csrf_token %}
            <button type="submit" class="vozek-button crypto-btn" style="display: none;">Plačaj s kriptovaluto</button>

    </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe("{{ stripe_publishable_key }}");
  const clientSecret = "{{ client_secret }}";
  const orderId = "{{ order_id }}";

  const elements = stripe.elements({ clientSecret });
  const paymentElement = elements.create("payment");
  paymentElement.mount("#payment-element");

  if (orderId) {
    const cryptoForm = document.getElementById("crypto-payment-form");
    cryptoForm.action = `/api/crypto/${orderId}/`;
  }

  document.getElementById("payment-form").addEventListener("submit", async (event) => {
    event.preventDefault();
    const { error } = await stripe.confirmPayment({
      elements,
      confirmParams: {
        return_url: window.location.origin + "/success/?order_id=" + orderId,
      },
    });
    if (error) {
      document.getElementById("error-message").textContent = error.message;
    }
  });
</script>
{% endblock %}

