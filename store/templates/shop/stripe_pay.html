{% extends 'base.html' %}
{% block content %}
<h2>Zaključi plačilo</h2>

<form id="payment-form">
  <div id="payment-element"></div>
  <button id="submit">Plačaj</button>
  <div id="error-message"></div>
</form>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe("{{ stripe_publishable_key }}");
  const clientSecret = "{{ client_secret }}";

  const elements = stripe.elements({ clientSecret });
  const paymentElement = elements.create("payment");
  paymentElement.mount("#payment-element");

  document.getElementById("payment-form").addEventListener("submit", async (event) => {
    event.preventDefault();
    const { error } = await stripe.confirmPayment({
      elements,
      confirmParams: {
        return_url: window.location.origin + "/success/",
      },
    });
    if (error) {
      document.getElementById("error-message").textContent = error.message;
    }
  });
</script>
{% endblock %}
